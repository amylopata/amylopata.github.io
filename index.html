<!DOCTYPE html>
<!--Comment-->
<html lang="en">
  <head>
	<meta charset="utf-8">
	<meta name='viewport' content='width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no' />
	<title>Carnegie Mellon Accessibility Map</title>

	<!-- Leaflet -->
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
	<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
	<script src="https://unpkg.com/@ngageoint/leaflet-geopackage@3.0.3/dist/leaflet-geopackage.js"></script>
	<script src='//api.tiles.mapbox.com/mapbox.js/plugins/leaflet-omnivore/v0.3.1/leaflet-omnivore.min.js'></script>
	<!-- jQuery -->  
	<script src="https://unpkg.com/jquery@3.3.1/dist/jquery.min.js"></script>
		
	<style>
		body { margin:0; padding:0; }
		body, table, tr, td, th, div, h1, h2, input { font-family: "Calibri", "Trebuchet MS", "Ubuntu", Serif; font-size: 11pt; }
		#map { 
			position:absolute; 
			top:0; 
			bottom:0; 
			width:100%; /* full size */
			z-index: 0;
		} 
		.ctl {
			padding: 2px 10px 2px 10px;
			background: white;
			background: rgba(255,255,255,0.9);
			box-shadow: 0 0 15px rgba(0,0,0,0.2);
			border-radius: 5px;
			text-align: right;
		}
		.title {
			font-size: 18pt;
			font-weight: bold;
		}
		.src {
			font-size: 10pt;
		}
		#control {
			position: absolute;
			z-index: 9;
			top: 5px;
			right: 5px;
			background-color: beige;
			border-color: black;
			border-style: double;
			width:min-content;
			padding: 10px;
		}
		#control p {
			font-size: 12px;
		}
		#control div {
			padding: 5px;
		}
		
		#hamburger, #hamburger:hover {
			display: none;
			background-image: url('/icons/hamburger_menu.png');
			background-repeat: no-repeat;
			background-size: contain;
			background-position: center;
			background-color: #333333;
			color: transparent;
			position: absolute;
			top: 5px;
			right: 5px;
			width: 48px;
			height: 48px;
			z-index: 9;
		}
		
		@media only screen and (max-width: 1100px) {
			#control {
				display: none;
			}
		}
		@media only screen and (max-width: 1100px) {
			#hamburger, #hamburger:hover {
				display: block;
			}
		}
		.leaflet-tooltip {
			font-size: 8pt;
			padding: 3px;
		}
		.leaflet-tooltip-top:before, 
		.leaflet-tooltip-bottom:before, 
		.leaflet-tooltip-left:before, 
		.leaflet-tooltip-right:before {
			border: none !important;
		}
		.legend img {
			width: 16px;
		}
		div.legend {
			border-style:solid;
			border-width: 1px;
			border-color: gray;
		}
		span.all {
			text-decoration: underline;
			text-decoration-color: #D41159;
			text-decoration-style: dashed;
			text-decoration-thickness: 3px;
		}
		span.accessible {
			text-decoration: underline;
			text-decoration-color: #1A85FF;
			text-decoration-style: solid;
			text-decoration-thickness: 3px;
		}
	</style>

</head>
<body>
<div id="hamburger">
</div>
<div id="control">
	<div>
	<label for="origin">From:</label>
	<select name="origin" id="origin" onchange="showroute();">
		<option value="BH">Baker Hall</option> 
		<option value="CUC">Cohon University Center</option> 
		<option value="CIC">Collaborative Innovation Center</option> 
		<option value="CFA">College of Fine Arts</option> 
		<option value="CYH">Cyert Hall</option>
		<option value="DH">Doherty Hall</option> 
		<option value="DON">Donner Hall</option> 
		<option value="ECG">East Campus Garage</option> 
		<option value="GHC">Gates Hillman Center</option> 
		<option value="HOA">Hall of Arts</option>
		<option value="HBH">Hamburg Hall</option> 
		<option value="HH">Hamerschlag Hall</option> 
		<option value="HL">Hunt Library</option> 
		<option value="MM">Margaret Morrison Carnegie Hall</option> 
		<option value="NSH">Newell-Simon Hall</option> 
		<option value="PCA">Purnell Center</option> 
		<option value="PH">Porter Hall</option> 
		<option value="POS">Posner Hall</option> 
		<option value="REH">Roberts Engineering Hall</option> 
		<option value="RES">Resnik House</option> 
		<option value="SC">Scott Hall</option> 
		<option value="EDS">Smith Hall</option> 
		<option value="WH">Warner Hall</option> 
		<option value="WEH">Wean Hall</option> 
		<option value="WWG">West Wing</option>
	</select>
	<label for="destination">To:</label>
	<select name="destination" id="destination" onchange="showroute();">
		<option value="BH">Baker Hall</option> 
		<option selected value="CUC">Cohon University Center</option> 
		<option value="CIC">Collaborative Innovation Center</option> 
		<option value="CFA">College of Fine Arts</option> 
		<option value="CYH">Cyert Hall</option>
		<option value="DH">Doherty Hall</option> 
		<option value="DON">Donner Hall</option> 
		<option value="ECG">East Campus Garage</option> 
		<option value="GHC">Gates Hillman Center</option> 
		<option value="HOA">Hall of Arts</option>
		<option value="HBH">Hamburg Hall</option> 
		<option value="HH">Hamerschlag Hall</option> 
		<option value="HL">Hunt Library</option> 
		<option value="MM">Margaret Morrison Carnegie Hall</option> 
		<option value="NSH">Newell-Simon Hall</option> 
		<option value="PCA">Purnell Center</option> 
		<option value="PH">Porter Hall</option> 
		<option value="POS">Posner Hall</option> 
		<option value="REH">Roberts Engineering Hall</option> 
		<option value="RES">Resnik House</option> 
		<option value="SC">Scott Hall</option> 
		<option value="EDS">Smith Hall</option> 
		<option value="WH">Warner Hall</option> 
		<option value="WEH">Wean Hall</option> 
		<option value="WWG">West Wing</option>
	</select>
	</div>
	<div>
	<div>
	<input type="checkbox" checked name="all" id="all">
	<label for="all">Show shortest <span class="all">overall path</span></label>
	</div>
	<div>
	<input type="checkbox" checked name="accessible" id="accessible"">
	<label for="accessible">Show shortest <span class="accessible">accessible path</span></label>
	</div>
	<div>
	<input type="checkbox" name="slope" id="slope">
	<label for="data">Show slope data</label>
	</div>
	</div>
	<div class="legend">
	<div>
	<img src="/icons/accessible_with_automatic_door.png"/>
	<span>Accessible with automatic door</span>
	</div>
	<div>
	<img src="/icons/accessible_without_automatic_door.png"/>
	<span>Accessible - no automatic door</span>
	</div>
	<div>
	<img src="/icons/inaccessible.png"/>
	<span>Inaccessible</span>
	</div>
	<div>
	<img src="/icons/unknown.png"/>
	<span>Unknown</span>
	</div>
	</div>
	<div>
	<p>These routes were generated automatically using AI.  As a result the classification of routes as accessible or inaccessible is not guaranteed to be accurate.</p>
	</div>
</div>
<div id="map"></div>

<script>
"use strict";
var overallpath1;
var accessiblepath1;
var overallpath2;
var accessiblepath2;
/*Load a KML file containing a specific path and add to the map*/
function loadpath(layerfile, color = '#D41159', dash = "4,4") {
	var customLayer = L.geoJson( null, {
		style : function(feature) {
			return {color: color, dashArray: dash};
		}
	});
	return omnivore.kml( './paths/' + layerfile, null, customLayer).addTo(map);
}
	
/*Clear all current paths from the map*/
function clearPaths() {	
		if (map.hasLayer(overallpath1)) {map.removeLayer(overallpath1)};
		if (map.hasLayer(overallpath2)) {map.removeLayer(overallpath2)};
		if (map.hasLayer(accessiblepath1)) {map.removeLayer(accessiblepath1)};
		if (map.hasLayer(accessiblepath2)) {map.removeLayer(accessiblepath2)};
}
/*Show the currently selected paths on the map*/
function showroute(e) {
		clearPaths();
		var origin;
		var destination;
		var basename1;
		var basename2;
		var layerfile1;
		var layerfile2;
		var overall;
		var accessible;
		origin = $('#origin').val();
		destination = $('#destination').val();
		basename1 = origin + destination;
		basename2 = destination + origin;
		overall = $('#all').prop("checked");
		accessible = $('#accessible').prop("checked");
		if (overall) {
			layerfile1 = basename1 + '-all.kml';
			overallpath1 = loadpath(layerfile1);	   
			layerfile2 = basename2 + '-all.kml';
			overallpath2 = loadpath(layerfile2);	   			
		}
		if (accessible) {
			layerfile1 = basename1 + '-access.kml';
			accessiblepath1 = loadpath(layerfile1, '#1A85FF', "");
			layerfile2 = basename2 + '-access.kml';
			accessiblepath2 = loadpath(layerfile2, '#1A85FF', "");
		}
		if ($('#hamburger').is(":visible")) {
			$('#control').hide();
		}
}

function toggleSlope(e) {
	if ($('#slope').prop("checked")) {
		map.removeLayer(slopelyr);
	} else {
		slopelyr.addTo(map);
	}
}

function showcontrol(e) {
	$('#control').show();
}
$(document).ready(function(){
	$('#all').change(showroute);
	$('#accessible').change(showroute);
	$('#slope').change(toggleSlope);
	$('#hamburger').click(showcontrol);
	showroute();
 }
);


// Base layers
//  .. OpenStreetMap
var osm = L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'});


// Overlay orthomosaic layer (TMS)
var lyr = L.tileLayer('./{z}/{x}/{y}.png', {tms: true, 
	opacity: 1, 
	attribution: "",
	maxZoom: 21
});

//Overlay slope layer (TMS)

var slopelyr = L.tileLayer('slope-tiles/{z}/{x}/{y}.png', {tms: true, 
	opacity: 1, 
	attribution: "",
	maxZoom: 21
});

// Map
var map = L.map('map', {
	center: [40.44253, -79.94333],
	opacity: 1,
	zoom: 17,
	minZoom: 0,
	maxZoom: 21,
	layers: [osm]
});

var basemaps = {"OpenStreetMap": osm}
var overlaymaps = {"Layer": lyr}
lyr.addTo(map);

//Add building names
L.geoPackageFeatureLayer([], {
	geoPackageUrl: './overlays/building_labels.gpkg',
	layerName: 'building_labels',
	pointToLayer: function (geoJsonPoint, latlng) {
		var tooltip;
		var nullIcon;
		var marker;
		tooltip = L.tooltip({
			permanent:true,
			direction: 'center',
		});
		nullIcon = L.icon({iconUrl: 'icons/accessible_without_automatic_door.png', iconSize: [1,1]})
		marker = L.marker(
			latlng, {
			opacity: 0,
			icon: nullIcon
		}).bindTooltip(tooltip);
		marker.setTooltipContent(geoJsonPoint.properties.name);
		return marker;
	}
}).addTo(map);

//Add building entrances
L.geoPackageFeatureLayer([], {
geoPackageUrl: './overlays/all_building_entrances.gpkg',
layerName: 'building_entrances',
pointToLayer: function (geoJsonPoint, latlng) {
		var iconpath;
		var icon;
		var marker;
		switch(geoJsonPoint.properties.entrance) {
			case 'accessible':
				iconpath = 'icons/accessible_without_automatic_door.png';
				break;
			case 'inaccessible':
				iconpath = 'icons/inaccessible.png';
				break;
			case 'automatic':				
				iconpath = 'icons/accessible_with_automatic_door.png';
				break;
			default:
			iconpath = 'icons/unknown.png';
		}
		icon = L.icon({
			iconUrl: iconpath,
			iconSize: [16, 16],	
			});
		marker = L.marker(latlng, {
			icon: icon
			}
		);
		return marker;
	}
}).addTo(map);

/*Hide labels when zoomed out*/
var tooltipThreshold = 17;
map.on('zoomend', function() {
  if (map.getZoom() < tooltipThreshold) {
      $(".leaflet-tooltip").css("display","none")
  } else { 
      $(".leaflet-tooltip").css("display","block")
  }
})
	
</script>

</body>
</html>


